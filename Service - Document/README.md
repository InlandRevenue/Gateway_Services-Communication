
![IRD logo](../Images/IRlogo.gif)
![Software Dev](../Images/SoftwareDev.png)

# Document Service 

#### Release version 1.0

## About the service

The Document Service enables documents to be retrieved by external software platforms as well as be submitted by external software platforms.   
* Documents can comprise of mail generated by Inland Revenue for communicating with customers, as well as documents request by Inland Revenue from a customer, and documents a customer voluntarily provides to Inland Revenue.
* Documents from Inland Revenue are PDFs, while documents provided to Inland Revenue can be of many different file formats. 


## Key documentation

- YAML file
	- View and download [Document service YAML file](Document%202023-11-22.yaml)

- Build pack
	- [Download the Document service build pack](Build%20pack%20-%20Document%20Service.pdf)

- Message samples
	- [View message samples for requests and responses](#message-samples)

>**NOTE:** The included [Document 2023-11-22.yaml](Document%202023-11-22.yaml) file can be used along with an OpenAPI editor such as [editor.swagger.io](https://editor.swagger.io) to view technical specifications for this operation and generate example client code. 

## Environment information

- [Mock environment information - emulated services, mindmap and test data](#mock-environment-information)

- [Test environment information - URL endpoints](#test-environment-information)

- [Production environment information - URL endpoint](#prod-environment-information)


## Supporting services

- Service: [Identity and access](https://github.com/InlandRevenue/Gateway_Services-Access/tree/master/Identity%20and%20Access) - view how to integrate, OAuth requests and responses message samples and build pack
- Service: [Notifications](../Service%20-%20Notifications)

---
## Message samples

* Sample JSON payload messages
	* Document Create - POST
	    * [Request body with Return Submission Key](Sample%20Files/Sample_POST_Document_RequestBody_RTNSUB.json)
	    * [Request body with DocumentLocationID](Sample%20Files/Sample_POST_Document_RequestBody_DocumentLocationID.json)
	    * [Response body](Sample%20Files/Sample_POST_Document_ResponseBody.json)
	* Document Retrieve - GET
	    * Request body - n/a
	    * [Response body](Sample%20Files/Sample_GET_Document_ResponseBody.json)
	* Document Update - PUT
	    * [Request body](Sample%20Files/Sample_PUT_Document_RequestBody.json)
	    * Response body - n/a
	* Document List - POST
	    * [Request body with Return Submission Key](Sample%20Files/Sample_POST_List_RequestBody_RTNSUB.json)
        * [Request body with IRD number](Sample%20Files/Sample_POST_List_RequestBody_IRDNumber.json)
        * [Response body with previously submitted return attachments](Sample%20Files/Sample_POST_List_ResponseBody_RTNSUB.json)
        * [Response body with Inland Revenue-generated letters](Sample%20Files/Sample_POST_List_ResponseBody_Letters.json)
    * Error
        * [Sample error response body](Sample%20Files/Sample_Error_ResponseBody.json)
	
---
<a name="mock-environment-information"></a>
## Mock environment information

### Mock emulated services URL

Description | URL
---|---
 Landing Page |  https://document.test.services.ird.govt.nz

#### Mock URL - ` https://document.test.services.ird.govt.nz/gateway/document/{Service}`
| Service | HTTP request types | Description | 
| :--: | :--: | -- |
| document  | `GET` | This web service will get the document for a given document ID | 
| document | `POST` | This web service will allow a document to be submitted through the document service. | 
| document | `PUT` | This web service will allow a document to be marked as invalid. | 
| list | `POST` | This web service will list out the available documents for the input parameters.|

>**NOTE:** The `status` service might not be available in the mock environment.

### Mock environment authentication
   * Consumers of this mock service must be authenticated.
   * Access delegation/restriction is not emulated, and any authenticated user has access to the test data.
   * Authentication is provided using one of two methods:
     1. OAuth
        * OAuth token issued by the mock OAuth service. Any valid token issued by the mock OAuth service can be used to access this service.
        * Please consult the [mock OAuth service documentation](https://mock-oauth.ird.digitalpartner.services/) for further details about the authentication process.
        * The OAuth token should be provided in the 'Authorization' request header as follows:
        ```
        Authorization: Bearer {OAuthAccessToken}
        ```
     2. JWT
        * Alternatively a self-issued JWT may be used to access the service.
        * Please consult the [Document service build pack](Build%20pack%20-%20Document%20Service.pdf) for information on the token structure.
        * The mock service does not validate the following JWT attributes:
            * "sub" field
            * "iss" field
            * token signature
        * The JWT should be provided in the 'Authorization' request header as follows (note the 'Bearer' prefix is omitted):
        ```
        Authorization: {JWT}
        ```

### Document mock scenarios mindmap

- [View larger image](images/Document%20Mock%20Service%20Mindmap.png)
![Mock Scenarios](images/Document%20Mock%20Service%20Mindmap.png)

### Test data

* This table shows which scenarios (as per their numbers in the mindmap) require specific data to trigger the expected responses.
* Text in italics represents the name of the JSON node in the request (for POST requests) or query parameter (for PUT and GET requests).

  Scenario ID | Data | Http status | Response 
    --- | --- | --- | ---
    MOCK-DOC-005 | *Document*: "...invalid" | 400 | EV1100 - Invalid input parameters. Please check documentation
    MOCK-DOC-006 | *FileName*: {unsupported file type, e.g. "myFile.exe"} | 400 | EV1100 - Invalid input parameters. Please check documentation
    MOCK-DOC-007 | *DocumentID*: 5404631446 | 200 | Document information
    MOCK-DOC-008 | *DocumentID*: 5413355273 | 200 | Document information
    MOCK-DOC-009 | *DocumentID*: {numeric value e.g. 123} | 400 | DOC301 - A document cannot be found for that document ID.
    MOCK-DOC-010 | *DocumentID*: 5413355273 | 200 |
    MOCK-DOC-011 | *DocumentID*: {numeric value e.g. 123} | 400 | DOC301 - A document cannot be found for that document ID.
    MOCK-DOC-018 | *ExtIDType*: {value other than "RTNSUB"} | 400 | EV1100 - Invalid input parameters. Please check documentation

---
<a name="test-environment-information"></a>
## Test environment information

#### Testing URL - `https://test5.services.ird.govt.nz:4046/gateway/document/{Service}`
| Service | HTTP request types | Description | 
| :--: | :--: | -- |
| document  | `GET` | This web service will get the document for a given document ID | 
| document | `POST` | This web service will allow a document to be submitted through the document service. | 
| document | `PUT` | This web service will allow a document to be marked as invalid. | 
| list | `POST` | This web service will list out the available documents for the input parameters.|
| status | `GET` | This web service sends a 200 HTTP response with a message body of `OK`. This is preferred over service "ping" functionality as this should validate the service and credential configuration.|


>**NOTE:** These endpoints are subject to change due to environment updates in the future. 

### Test scenarios report template

- [Download Test Scenarios report template](Document%20Service%20-%20Test%20Scenarios%20Report%20Template.docx)

---
<a name="prod-environment-information"></a>
## Prod environment information

#### Production URL - `https://services.ird.govt.nz:4046/gateway/document/{Service}`
| Service | HTTP request types | Description | 
| :--: | :--: | -- |
| document  | `GET` | This web service will get the document for a given document ID | 
| document | `POST` | This web service will allow a document to be submitted through the document service. | 
| document | `PUT` | This web service will allow a document to be marked as invalid. | 
| list | `POST` | This web service will list out the available documents for the input parameters.|
| status | `GET` | This web service sends a 200 HTTP response with a message body of `OK`. This is preferred over service "ping" functionality as this should validate the service and credential configuration.
