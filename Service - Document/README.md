![IRD logo](../Images/IRlogo.gif)
![Software Dev](../Images/SoftwareDev.png)

# Document Service 

#### Version 1.0

The Document Service enables documents to be retrieved by external software platforms as well as be submitted by external software platforms.   
 
Documents can comprise of mail generated by Inland Revenue for communicating with customers, as well as documents request by Inland Revenue from a customer, and documents a customer voluntarily provides to Inland Revenue.  Documents from Inland Revenue are PDFs, while documents provided to Inland Revenue can be of many different file formats. 

## Key Features:
* View and download [build packs for Document Service](Build%20pack%20-%20Document%20Service.pdf)
* View and download [YAML file](Documents.yaml)


## Sample JSON messages



* POST /document - Document Service Post
	    
	* [Document Request](Sample%20Files/POSTDocumentRequest.json)
	* [Document Response 200](Sample%20Files/POSTDocumentResponse200.json)
	* [Document Response 400](Sample%20Files/POSTDocumentResponse400.json)
	* [Document Response 500](Sample%20Files/POSTDocumentResponse500.json)
	
* PUT /document - Document Service Invalidate
	* [Document Request](Sample%20Files/PUTDocumentRequest.json)
	* [Document Response 200](Sample%20Files/PUTDocumentResponse200.json)
	* [Document Response 400](Sample%20Files/PUTDocumentResponse400.json)
	* [Document Response 500](Sample%20Files/PUTDocumentResponse500.json)

* GET /document	- Document Service Retrieve
	* [Document Request](Sample%20Files/GETDocumentRequestURL.txt)
	* [Document Response 200](Sample%20Files/GETDocumentResponse200.json)
	* [Document Response 400](Sample%20Files/GETDocumentResponse400.json)
	* [Document Response 500](Sample%20Files/GETDocumentResponse500.json)	
	
* POST /list - Document Service List
	* [List Request](Sample%20Files/POSTListRequest.json)
	* [List Response 200](Sample%20Files/POSTListResponse200.json)
	* [List Response 400](Sample%20Files/POSTListResponse400.json)
	* [List Response 500](Sample%20Files/POSTListResponse500.json)	

## Message Samples
---
* Sample JSON payload messages
	* Document Create
	    * [Request body with Return Submission Key](Sample%20Files/Sample_POST_Document_RequestBody_RTNSUB.json)
	    * [Request body with DocumentLocationID](Sample%20Files/Sample_POST_Document_RequestBody_DocumentLocationID.json)
	    * [Response body](Sample%20Files/Sample_POST_Document_ResponseBody.json)
	* Document Retrieve
	    * Request body - n/a
	    * [Response body](Sample%20Files/Sample_GET_Document_ResponseBody.json)
	* Document Update
	    * [Request body](Sample%20Files/Sample_PUT_Document_RequestBody.json)
	    * Response body - n/a
	* Document List
	    * [Request body with Return Submission Key](Sample%20Files/Sample_POST_List_RequestBody_RTNSUB.json)
        * [Request body with IRD number](Sample%20Files/Sample_POST_List_RequestBody_RTNSUB.json)
        * [Response body with previously submitted return attachments](Sample%20Files/Sample_POST_List_ResponseBody_RTNSUB.json)
        * [Response body with Inland Revenue-generated letters](Sample%20Files/Sample_POST_List_ResponseBody_Letters.json)
    * Error
        * [Sample error response body](Sample%20Files/Sample_Error_ResponseBody.json)

## Mock Environment Information
---
### Mock Emulated Services URL
Description | URL
---|---
 Landing Page | https://mock-doc.ird.digitalpartner.services
 Service Path | https://mock-doc.ird.digitalpartner.services/secure/gateway/document 
 Document Resource | https://mock-doc.ird.digitalpartner.services/secure/gateway/document/document 
 List Resource | https://mock-doc.ird.digitalpartner.services/secure/gateway/document/list 
### Mock Environment Authentication
   * Consumers of this mock service must be authenticated.
   * Access delegation/restriction is not emulated, and any authenticated user has access to the test data.
   * Authentication is provided using one of two methods:
     1. OAuth
        * OAuth token issued by the mock OAuth service. Any valid token issued by the mock OAuth service can be used to access this service.
        * Please consult the [mock OAuth service documentation](https://mock-oauth.ird.digitalpartner.services/) for further details about the authentication process.
        * The OAuth token should be provided in the 'Authorization' request header as follows:
        ```
        Authorization: Bearer {OAuthAccessToken}
        ```
     2. JWT
        * Alternatively a self-issued JWT may be used to access the service.
        * Please consult the [Document service build pack](Build%20pack%20-%20Document%20Service.pdf) for information on the token structure.
        * The mock service does not validate the following JWT attributes:
            * "sub" field
            * "iss" field
            * token signature
        * The JWT should be provided in the 'Authorization' request header as follows (note the 'Bearer' prefix is omitted):
        ```
        Authorization: {JWT}
        ```
### Document Mock Scenarios MindMap

- [View larger image](images/Document%20Mock%20Service%20Mindmap.png)
![Mock Scenarios](images/Document%20Mock%20Service%20Mindmap.png)

### Test data

* This table shows which scenarios (as per their numbers in the mindmap) require specific data to trigger the expected responses.
* Text in italics represents the name of the JSON node in the request (for POST requests) or query parameter (for PUT and GET requests).

  Scenario ID | Data | Http status | Response 
    --- | --- | --- | ---
    MOCK-DOC-005 | *Document*: "...invalid" | 400 | EV1100 - Invalid input parameters. Please check documentation
    MOCK-DOC-006 | *FileName*: {unsupported file type, e.g. "myFile.exe"} | 400 | EV1100 - Invalid input parameters. Please check documentation
    MOCK-DOC-007 | *DocumentID*: 5404631446 | 200 | Document information
    MOCK-DOC-008 | *DocumentID*: 5413355273 | 200 | Document information
    MOCK-DOC-009 | *DocumentID*: {numeric value e.g. 123} | 400 | DOC301 - A document cannot be found for that document ID.
    MOCK-DOC-010 | *DocumentID*: 5413355273 | 200 |
    MOCK-DOC-011 | *DocumentID*: {numeric value e.g. 123} | 400 | DOC301 - A document cannot be found for that document ID.
    MOCK-DOC-018 | *ExtIDType*: {value other than "RTNSUB"} | 400 | EV1100 - Invalid input parameters. Please check documentation

	
## URL Endpoints

| Endpoint | URL |
| --------|---------|-------|
| Mock | https://mock-doc.ird.digitalpartner.services/secure/gateway/document/ |
| Testing environment | https://test3.services.ird.govt.nz:4046/Gateway/documents/v1/ |
| Pre-Production | https://test4.services.ird.govt.nz:4046/Gateway/documents/v1/ |
| Production | https://services.ird.govt.nz:4046/Gateway/documents/v1/  |





